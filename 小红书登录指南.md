# 小红书登录指南

本文档将介绍如何在MCP服务中登录小红书，并将登录信息保存到服务中。

## 方法一：通过管理界面登录

这是最直观的登录方式，适合首次使用的用户。

### 步骤：

1. **打开管理界面**
   - 访问 http://localhost:9091/admin
   - 你将看到服务的管理界面

2. **进入登录管理**
   - 点击左侧导航栏中的"登录管理"
   - 或者直接访问 http://localhost:9091/login

3. **选择小红书平台**
   - 在平台列表中选择"小红书"
   - 点击"开始登录"

4. **选择登录方式**
   - 支持两种登录方式：
     - **二维码登录**：扫描显示的二维码进行登录
     - **Cookie登录**：直接输入小红书的Cookie信息

5. **完成登录**
   - 如果选择二维码登录，使用小红书APP扫描二维码即可
   - 如果选择Cookie登录，需要先获取小红书的Cookie

## 方法二：通过API登录

适合程序自动登录或集成到其他系统中。

### 二维码登录：

```bash
# 1. 启动登录流程，获取二维码
curl -X POST http://localhost:9091/api/login/start -H "Content-Type: application/json" -d '{"platform": "xhs", "login_type": "qrcode"}'

# 2. 轮询登录状态，直到登录成功
curl -X GET http://localhost:9091/api/login/session/{session_id}
```

### Cookie登录：

```bash
# 直接使用Cookie进行登录
curl -X POST http://localhost:9091/api/login/start -H "Content-Type: application/json" -d '{"platform": "xhs", "login_type": "cookie", "cookie": "你的小红书Cookie"}'
```

## 方法三：通过Cookie文件登录

适合手动获取Cookie后进行登录。

### 步骤：

1. **获取小红书Cookie**
   - 打开浏览器，访问小红书网站
   - 登录你的小红书账号
   - 打开开发者工具（F12），进入"网络"标签
   - 刷新页面，查看任意请求的Cookie
   - 复制完整的Cookie字符串

2. **创建Cookie文件**
   - 在`browser_data/xhs`目录下创建`cookies.txt`文件
   - 将复制的Cookie字符串粘贴到文件中

3. **重启服务**
   - 重启MCP服务，服务会自动读取Cookie文件
   ```bash
   docker-compose restart mcp-service
   ```

## 如何获取小红书Cookie

### 方法：

1. 打开Chrome浏览器，访问 https://www.xiaohongshu.com
2. 登录你的小红书账号
3. 按F12打开开发者工具
4. 切换到"应用"（Application）标签
5. 在左侧导航栏中选择"Cookie" -> "https://www.xiaohongshu.com"
6. 复制所有Cookie，或者复制`web_session`字段的值
7. 将Cookie保存到文件或直接使用

## 验证登录状态

登录成功后，可以通过以下方式验证登录状态：

```bash
# 检查登录状态
curl -X GET http://localhost:9091/api/login/status/xhs
```

如果登录成功，返回结果中会包含`is_logged_in: true`。

## 注意事项

1. **Cookie有效期**：小红书Cookie有一定的有效期，过期后需要重新获取
2. **安全性**：不要将Cookie分享给他人，避免账号被盗
3. **频率限制**：避免频繁登录，防止账号被封
4. **浏览器兼容性**：建议使用Chrome浏览器获取Cookie
5. **服务重启**：修改Cookie后需要重启服务才能生效

## 故障排除

如果登录失败，可以查看服务日志：

```bash
docker-compose logs mcp-service --tail 100
```

常见错误：

- `登录过期，Cookie失效`：Cookie已过期，需要重新获取
- `实例状态错误: InstanceState.BUSY`：浏览器实例忙碌，等待一段时间后重试
- `启动登录失败`：检查Redis配置和网络连接

## 登录后使用

登录成功后，你可以使用以下API进行小红书搜索：

```bash
# 搜索大模型面试相关内容
curl -X POST http://localhost:9091/api/admin/inspector/execute -H "Content-Type: application/json" -d '{"tool": "xhs_search", "params": {"keywords": "大模型面试", "page_num": 1, "page_size": 10}}'
```

登录信息会自动保存到Redis中，服务重启后会自动恢复登录状态。